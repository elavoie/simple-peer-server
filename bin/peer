#!/usr/bin/env node
var SimplePeer = require('simple-peer')
var SimpleSocket = require('simple-websocket')
var wrtc = require('electron-webrtc')()

var host = process.argv[2]
console.log('host: ' + host)
var initiator = Boolean(process.argv[3])
console.log('initiator: ' + initiator)
var socket = new SimpleSocket('ws://' + host + (initiator ? '/initiator' : '/peer'))

console.log('socket: ' + socket)

var p = new SimplePeer({ 'initiator': initiator, wrtc: wrtc })
socket.on('connect', function () {
  p.on('signal', function (data) {
    console.log('signal: ' + JSON.stringify(data))
    socket.send(JSON.stringify(data))
  })

  p.on('connect', function () {
    console.log('connected')
  })

  p.on('close', function () {
    console.log('closed')
  })

  p.on('error', function () {
    console.log('closed')
  })
})

socket.on('data', function (data) {
  p.signal(JSON.parse(data))
})

